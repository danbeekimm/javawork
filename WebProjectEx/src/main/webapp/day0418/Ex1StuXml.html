<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<link
	href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Jua&family=Lobster&family=Nanum+Pen+Script&display=swap"
	rel="stylesheet">
<style>
div.list {
	font-size: 20px;
	font-family: "Jua";
	position: absolute;
	left: 700px;
	top: 100px;
}

div.form {
	font-size: 20px;
	font-family: "Jua";
	position: absolute;
	left: 200px;
	top: 100px;
}
</style>
<script type="text/javascript">
	$(function(){
		//처음 로딩시 list() 호출
		list();//>>>>>>>>>>>>>> 이거말구
		
		
	//버튼클릭시 목록가져오기
	$("#btn1").click(function(){
		list();
	});
		//처음엔 임력폼안보이게할거임
		$("div.form").hide();
		//버튼 클릭시 입력폼이 나타낫다사라졌다하기
		$("#btnshow").click(function(){
			$("div.form").toggle(); //show+hide
		});
		//select첫번째 value값을 이미지 selphoto에 넣기
		$("#selphoto").attr("src",$("#photo").val());
		
		//select 변경시 value 얻어서 selphoto의 이미지 변경
		$("#photo").change(function(){
			$("#selphoto").attr("src",$(this).val());
		});
		//db저장이벤트
		$("td.send").click(function(){
			//입력값읽기
			var name=$("#name").val();
			var hp=$("#hp").val();
			var addr=$("#addr").val();
			var photo=$("#photo").val();
			
			if(name.length==0 || hp.length==0 || addr.length==0){
				alert("데이타를 모두 입력해주세요");
				return;// 함수종료
			}
			
			$.ajax({ //자바코드는 에이젝스로 해서 여기서 설정하기
				type:"post",
				dataType:"html", //데이타를 리턴받지않으므로 html
				url:"studataread.jsp", //여기서 자바코드 설정, 
				
				//값주는 두가지 방법
				//data:{"name":name,"hp":hp,"addr":addr,"photo":photo}, //여기네임은 jsp의 네임임.값읽기밑
				data:"name="+name+"&hp="+hp+"&addr="+addr+"&photo="+photo,
				
				success:function(){ //jsp에 인서트가 석세스로 오고
					list();
					//입력값지우기
					$("#name").val("");
					$("#hp").val("");
					$("#addr").val("");

				}
			});
		});
		//삭제이벤트       클릭 / 클래스/ 펑션.
		$(document).on("click","button.del",function(){
			//alert($(this).attr("num")); //버튼에 있는 번호 확인하기 창뜨는거보고 //처리
		     //on: 현재 미래 있는거 다됨.
		var num=$(this).attr("num");

		var ans=confirm("삭제하려면 [확인]을 눌러주세요"); 
		console.log(ans);//창뜸 : 물어보는형태 //반환타입이 불린형(true,false)
		if(ans){
			$.ajax({
				type:"get",
				dataType:"html",
				data:{"num":num},
				url:"studelete.jsp",
				success:function(){
					list();
					alert("삭제되었습니다");
				}
			});
		}
		}); 
	});//end function
	//사용자함수 목록
	function list(){
		$.ajax({//에이젝스 타입임. 제이쿼리-에이젝스 함수- 
			type:"get", //타입에다 겟이냐 post냐
			url:"stutoxml.jsp",  //xml이 들어가잇는 파일명 이 넘어오는 파일경로 확장자는 jsp이지만 xml이자나
			dataType:"xml",  //엑스엠엘 들어가있다
			success:function(data){// 리스트 데이타가 여기로넘어옴
				var s="<table class='table table-bordered' style='width:500px;'>";
				s+= "<caption><b>"+$(data).find("stu").length+ //data에서 stu찾아서
				"개의 데이타가 있습니다</b></caption>";
				//stu 찾아서 반복
				//엘리먼트안에서 넘을찾고네임을찾고하는거
				$(data).find("stu").each(function(i,element){ //i는 0,1,2
					var d= $(element); //d가 stu
					s+="<tr>";
					s+="<td width='200' rowspan='5'>";
					s+="<img src='"+d.find("photo").text()+"' width=200>";
					s+="</td>";
					s+="<td>번호:"+d.find("num").text()+"</td>";
					s+="</tr>";
					//두번째줄
					s+="<tr><td>이름:"+d.find("name").text()+"</td></tr>";
					s+="<tr><td>핸드폰:"+d.find("hp").text()+"</td></tr>";
					s+="<tr><td>주소:"+d.find("addr").text()+"</td></tr>";
					s+="<tr><td>";
					//num 미리 얻기
					var num=d.find("num").text();
					//`${num}` : 에크마 6문법
					//클래스는 2번나오면 인식못해, class='del'이거넣고싶으면 뒤에 그냥붙이면 됨
					s+="<button type='button' class='btn btn-danger btn-xs del'  num="+num+">삭제</button>"
					s+="</td></tr>";
				});
				s+="</table>";
				$("div.list").html(s);
			},
			statusCode:{ //에러메세지
				404:function(){ //위에 url 찾을수없을때나오는 코드
					alert("파일을 찾을수없어요");
				},
				500:function(){
					alert("서버오류..코드를 다시살펴보세요")
				}
			}
		});
	}
	


</script>
</head>
<body>
	<div style="margin-left: 300px;">
		<button type="button" class="btn btn-success" id="btnshow">
			Stu 입력폼 show/hide</button>

		<button type="button" class="btn btn-info" id="btn1">Stu DB
			데이타 가져오기</button>
	</div>
	<div class="form">
		<form action="#" class="form-inline"> <!-- 인라인은 옆으로나오게하는거 -->
			<table class="table table-bordered" style="width: 400px;">
				<caption>
					<b>STU입력폼</b>
				</caption>
				<tr>
					<th bgcolor="pink" width="100">이름</th>
					<td><input type="text" id="name" class="form-control">
					</td>
				</tr>

				<tr>
					<th bgcolor="pink" width="100">핸드폰</th>
					<td><input type="text" id="hp" class="form-control"></td>
				</tr>

				<tr>
					<th bgcolor="pink" width="100">주소</th>
					<td><input type="text" id="addr" class="form-control">
					</td>
				</tr>

				<tr>
					<th bgcolor="pink" width="100">사진</th>
					<td>
					<select id="photo" style="width:100px;" 
					class="form-control">
					<script>
					for(i=1;i<=20;i++){
						document.write("<option value='../image/"+i+".jpg'>이미지"+i+"</option>");
					}
						</script></select>
					<img src="" id="selphoto" width="70" height="70">
				
					</td>
				</tr>
				<tr>
					<td colspan="2" style="cursor: pointer;" class="send" align="center"
					bgcolor="pink">DB저장</td>
				</tr>
			</table>
		</form>
	</div>
	<div class="list">list</div>
</body>


</html>